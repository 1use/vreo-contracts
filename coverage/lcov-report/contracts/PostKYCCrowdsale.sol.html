<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/PostKYCCrowdsale.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> PostKYCCrowdsale.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/32</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/7</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/37</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity 0.4.24;
&nbsp;
import "../node_modules/zeppelin-solidity/contracts/ownership/Ownable.sol";
import "../node_modules/zeppelin-solidity/contracts/crowdsale/Crowdsale.sol";
&nbsp;
&nbsp;
/// @title PostKYCCrowdsale
/// @author Sicos et al.
contract PostKYCCrowdsale is Crowdsale, Ownable {
&nbsp;
    struct Investment {
        bool isVerified;         // wether or not the investor passed the KYC process
        uint totalWeiInvested;   // total invested wei regardless of verification state
        // amount of token an unverified investor bought. should be zero for verified investors
        uint pendingTokenAmount;
    }
&nbsp;
    // total amount of wei held by unverified investors should never be larger than this.balance
    uint public pendingWeiAmount = 0;
&nbsp;
    // maps investor addresses to investment information
    mapping(address =&gt; Investment) public investments;
&nbsp;
    /// @dev Log entry on investor verified
    /// @param investor the investor's Ethereum address
    event InvestorVerified(address investor);
&nbsp;
    /// @dev Log entry on tokens delivered
    /// @param investor the investor's Ethereum address
    /// @param amount token amount delivered
    event TokensDelivered(address investor, uint amount);
&nbsp;
    /// @dev Log entry on investment withdrawn
    /// @param investor the investor's Ethereum address
    /// @param value the wei amount withdrawn
    event InvestmentWithdrawn(address investor, uint value);
&nbsp;
    /// @dev Verify investors
    /// @param _investors list of investors' Ethereum addresses
<span class="fstat-no" title="function not covered" >    function verifyInvestors(address[] _investors) public onlyOwne</span>r {
<span class="cstat-no" title="statement not covered" >        for (uint i = 0; i &lt; _investors.length; ++i) {</span>
<span class="cstat-no" title="statement not covered" >            address investor = _investors[i]</span>;
<span class="cstat-no" title="statement not covered" >            Investment storage investment = investments[investor]</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (!investment.isVerified) {</span>
<span class="cstat-no" title="statement not covered" >                investment.isVerified = true</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >                emit InvestorVerified(investor);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                uint pendingTokenAmount = investment.pendingTokenAmount</span>;
                // now we issue tokens to the verfied investor
<span class="cstat-no" title="statement not covered" >                if (pendingTokenAmount &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >                    investment.pendingTokenAmount = 0</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >                    _forwardFunds(investment.totalWeiInvested)</span>;
<span class="cstat-no" title="statement not covered" >                    _deliverTokens(investor, pendingTokenAmount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >                    emit TokensDelivered(investor, pendingTokenAmount);</span>
                }
            }
        }
    }
&nbsp;
    /// @dev Withdraw investment
    /// @dev Investors that are not verified can withdraw their funds
<span class="fstat-no" title="function not covered" >    function withdrawInvestment() publi</span>c {
<span class="cstat-no" title="statement not covered" >        Investment storage investment = investments[msg.sender]</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(!investment.isVerified)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint totalWeiInvested = investment.totalWeiInvested</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(totalWeiInvested &gt; 0)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        investment.totalWeiInvested = 0</span>;
<span class="cstat-no" title="statement not covered" >        investment.pendingTokenAmount = 0</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        pendingWeiAmount = pendingWeiAmount.sub(totalWeiInvested)</span>;
&nbsp;
        msg.sender.transfer(totalWeiInvested);
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit InvestmentWithdrawn(msg.sender, totalWeiInvested);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        assert(pendingWeiAmount &lt;= address(this).balance)</span>;
    }
&nbsp;
    /// @dev Prevalidate purchase
    /// @param _beneficiary the investor's Ethereum address
    /// @param _weiAmount the wei amount invested
<span class="fstat-no" title="function not covered" >    function _preValidatePurchase(address _beneficiary, uint _weiAmount) interna</span>l {
        // We only want the msg.sender to buy tokens
<span class="cstat-no" title="statement not covered" >        require(_beneficiary == msg.sender)</span>;
&nbsp;
        super._preValidatePurchase(_beneficiary, _weiAmount);
    }
&nbsp;
    /// @dev Process purchase
    /// @param _beneficiary the investor's Ethereum address
    /// @param _tokenAmount the token amount purchased
<span class="fstat-no" title="function not covered" >    function _processPurchase(address _beneficiary, uint _tokenAmount) interna</span>l {
<span class="cstat-no" title="statement not covered" >        Investment storage investment = investments[msg.sender]</span>;
<span class="cstat-no" title="statement not covered" >        investment.totalWeiInvested = investment.totalWeiInvested.add(msg.value)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (investment.isVerified) {</span>
            // If the investor's KYC is already verified we issue the tokens imediatly
<span class="cstat-no" title="statement not covered" >            _deliverTokens(_beneficiary, _tokenAmount)</span>;
<span class="cstat-no" title="statement not covered" >            emit TokensDelivered(_beneficiary, _tokenAmount);</span>
        } else {
            // If the investor's KYC is not verified we store the pending token amount
<span class="cstat-no" title="statement not covered" >            investment.pendingTokenAmount = investment.pendingTokenAmount.add(_tokenAmount)</span>;
<span class="cstat-no" title="statement not covered" >            pendingWeiAmount = pendingWeiAmount.add(msg.value)</span>;
        }
    }
&nbsp;
    /// @dev Forward funds
<span class="fstat-no" title="function not covered" >    function _forwardFunds() interna</span>l {
        // Ensure the investor was verified, i.e. his purchased tokens were delivered,
        // before forwarding funds.
<span class="cstat-no" title="statement not covered" >        if (investments[msg.sender].isVerified) {</span>
            super._forwardFunds();
        }
    }
&nbsp;
    /// @dev Forward funds
    /// @param _weiAmount the amount to be transfered
<span class="fstat-no" title="function not covered" >    function _forwardFunds(uint _weiAmount) interna</span>l {
<span class="cstat-no" title="statement not covered" >        pendingWeiAmount = pendingWeiAmount.sub(_weiAmount)</span>;
        wallet.transfer(_weiAmount);
    }
&nbsp;
    /// @dev Postvalidate purchase
    /// @param _beneficiary the investor's Ethereum address
    /// @param _weiAmount the amount invested
<span class="fstat-no" title="function not covered" >    function _postValidatePurchase(address _beneficiary, uint _weiAmount) interna</span>l {
        super._postValidatePurchase(_beneficiary, _weiAmount);
        // checking invariant
<span class="cstat-no" title="statement not covered" >        assert(pendingWeiAmount &lt;= address(this).balance)</span>;
    }
&nbsp;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Jun 21 2018 18:42:50 GMT+0200 (GMT+02:00)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
